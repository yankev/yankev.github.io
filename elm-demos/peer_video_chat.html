
<head>
    <script src="https://unpkg.com/peerjs@1.0.0/dist/peerjs.min.js">
    </script>
    <script>

        window.addEventListener('DOMContentLoaded', (event) => {
            var sendMessageBox = document.getElementById("sendMessageBox");
            var sendButton = document.getElementById("sendButton");
            var clearMsgsButton = document.getElementById("clearMsgsButton");

            var peer = new Peer();
            peer.on('open', function (id) {
                console.log('My peer ID is: ' + id);
                document.getElementById('peer_id').innerHTML = id;

                peer.on('call', function (call) {
                    console.log('connected?>');
                    call.answer(mediaStream);
                    });

            });

            navigator.mediaDevices.getUserMedia({ audio: true })
            .then(function(stream) {
            console.log('streaming?');
            
            window.AudioContext = window.AudioContext ||
            window.webkitAudioContext;
            var x = document.createElement("AUDIO");
            document.body.appendChild(x);
            const microphone = context.createMediaStreamSource(stream);
            const filter = context.createBiquadFilter();
            // microphone -> filter -> destination
            microphone.connect(filter);
            filter.connect(context.destination);


            document.getElementById("myBtn").addEventListener("click", function () {
                connectVal = document.getElementById("connectWithID").value;
                console.log(connectVal);
                var conn = peer.call(connectVal, stream);
                conn.on('open', function () {
                    // Receive messages
                    conn.on('data', function (data) {
                        console.log('Received', data);
                        addMessage("<span class=\"peerMsg\">Peer:</span> " + data);
                    });

                    // Send messages
                    conn.send('Hello I am the connector!');

                    addEventListeners(conn);
                });
            
            });
            
        })
            .catch(function(err) {
            console.log('failed');
            });

            });
    </script>
</head>

<body>

    <h3>Hello this is your id: <b id="peer_id"></b></h3>

    <p>
        Input: <input id="connectWithID" type="text" /> <button id="myBtn">Connect</button>
    </p>

</body>
